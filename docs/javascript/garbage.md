

# 内存泄漏，垃圾回收机制

## 内存泄漏

::: tip 划重点
  不再用到的内存，没有及时释放，就叫做 [内存泄漏](https://zh.wikipedia.org/zh-hans/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F)
:::
  
## 垃圾回收机制
大部分语言提供自动内存管理，使用完毕后自动释放内存，这就是**垃圾回收机制**

### 引用计数法
::: tip 划重点
  语言引擎内置一张“引用表”，保存了内存里面所有的资源（通常是各种值）的引用次数。如果一个值的引用次数是**0**，就表示这个值不再用到，所以可以将该块内存释放掉
:::
::: danger 导致内存泄漏的原因
  一个值不再需要了，引用数却不为0，垃圾回收机制无法释放这块内存，导致内存泄漏
:::
### 标记清除
::: tip 划重点
  **标记清除是js中最常见的垃圾回收方式**
  1. 当变量进入执行环境的时候，比如函数中声明一个变量，垃圾回收器将其标记为“进入环境”，当变量离开环境的时候（函数执行结束）将其标记为“离开环境”。
  2. 垃圾回收器会在运行的时候给存储在内存中的所有变量加上标记，然后去掉环境中的变量以及被环境中变量所引用的变量（闭包），在这些完成之后仍存在标记的就是要删除的变量了
:::

## 两种数据结构
::: tip 划重点
  [WeakMap](http://es6.ruanyifeng.com/#docs/set-map#WeakMap)和[WeakSet](http://es6.ruanyifeng.com/#docs/set-map#WeakSet)在新建引用的时候就声明了，这是弱引用，一旦消除该引用，所占用的内存就会被释放，所保存的键值对也会自动消失
:::

## 如何减少js中的垃圾回收
  [看这个吧，我懒: 小胡子哥的JavaScript垃圾回收机制](http://www.cnblogs.com/hustskyking/archive/2013/04/27/garbage-collection.html)
## 参考资料
1. [阮一峰老师的资料:javascript内存泄漏教程](http://www.ruanyifeng.com/blog/2017/04/memory-leak.html)
2. [javascript垃圾回收](https://www.cnblogs.com/dolphinX/p/3348468.html)
